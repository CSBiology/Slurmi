<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Writing a workflow </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Writing a workflow ">
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/CSBiology/Slurmi/blob/main/docs/docfx_project/articles/tutwf.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
  </head>

  <script type="module">
    import options from './../public/main.js'
    import { init } from './../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="writing-a-workflow">Writing a workflow</h1>

<p>Developing a workflow is one of the key parts of using the application.
Here, you define the sequential steps for completing the work.
Some of these steps are dependent on each other, and these dependencies are defined in the workflow.
To do this, you first create a job list.</p>
<pre><code class="lang-fsharp">let myJoblist  =
    [|
        Job (&quot;MyJob&quot;,[(&quot;MyProgram&quot;,[&quot;MyArgument1&quot;;&quot;MyArgument2&quot;])]);
        Job (&quot;MyJob2&quot;,[(&quot;MyProgram2&quot;,[&quot;MyArgument12&quot;;&quot;MyArgument22&quot;])]);
        Job (&quot;MyJob3&quot;,[(&quot;MyProgram3&quot;,[&quot;MyArgument13&quot;;&quot;MyArgument23&quot;])]);
    |]
</code></pre>
<p>This also enables you to set a value to multiple jobs at once, for instance:</p>
<pre><code class="lang-fsharp">myJoblist
|&gt; Array.mapi (fun i x -&gt; x |&gt; Job.SetCPUsPerTask(i))
</code></pre>
<p>In this case, the following values are set to each job:</p>
<pre><code class="lang-fsharp">myJoblist |&gt; Array.map (fun x -&gt; x |&gt; Job.tryGetCPUsPerTask)

// val it: obj option array = [|Some 0; Some 1; Some 2|]
</code></pre>
<p>The next step is to set up the dependencies.
Dependencies consist of a job, a list of dependencies, and a dependency type.
If more than one dependency is specified, the value <code>Any</code> or <code>All</code> is used to specify that any or all of the dependencies must be satisfied.
In the workflow itself, jobs are referenced by a name which is automatically assigned. To find the correct job by name, the <code>findDependencyName</code> function is used.</p>
<pre><code class="lang-fsharp">// simple dependency
let dependency = Afternotok [&quot;jobToDependOn&quot;]

// complex dependencies
myJoblist.[1] |&gt; Job.SetDependency((All,[|Afterany [(findDependencyName &quot;MyJob3&quot; myJoblist)];Afterok [(findDependencyName &quot;MyJob&quot; myJoblist);&quot;Example1&quot;;&quot;Example2&quot;]|]))
myJoblist.[2] |&gt; Job.SetDependency((Any,[|After [(findDependencyName &quot;MyJob&quot; myJoblist,Some 2);(&quot;alsoJustAnExample&quot;,None)]; Afternotok [findDependencyName &quot;MyJob&quot; myJoblist]|]))
</code></pre>
<p>The workflow is initiated with the joblist as an argument. Here you can set the required time and partition.</p>
<pre><code class="lang-fsharp">let myWorkflow = new Workflow(myJoblist)
myWorkflow |&gt; Workflow.SetTime((2,3,4,1))
myWorkflow |&gt; Workflow.SetPartition(&quot;csb&quot;)
</code></pre>
<p>To create the workflow, the <code>createWorkflowFromWFType</code> function is used.</p>
<pre><code class="lang-fsharp">let myWorkflow = createWorkflowFromWFType myWorkflow

// #!/bin/bash
// #SBATCH --time=02-03:04:01
// #SBATCH -p csb
// Job0=$(sbatch --parsable  MyJob)
// Job1=$(sbatch --parsable --dependency=afterany:$Job2,afterok:$Job0:Example1:Example2 MyJob2)
// Job2=$(sbatch --parsable --dependency=after:$Job0+2:alsoJustAnExample?afternotok:$Job0 MyJob3)
</code></pre>
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/CSBiology/Slurmi/blob/main/docs/docfx_project/articles/tutwf.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>